// This file source is in /SystemX/sources/Linux_for_Tegra/source/hardware/nvidia/t23x/nv-public/tegra234-p3737-0000+p3701-0000.dts
// Run ./dtbs_build.sh
// Copy compiled binary. sudo cp /SystemX/sources/Linux_for_Tegra/source/kernel-devicetree/generic-dts/dtbs/tegra234-p3737-0000+p3701-0000-nv.dtb /SystemX/sources/Linux_for_Tegra/kernel/dtb/
// run flash.sh

// SPDX-License-Identifier: GPL-2.0
/dts-v1/;

#include <dt-bindings/input/linux-event-codes.h>
#include <dt-bindings/input/gpio-keys.h>

#include "tegra234-p3701-0000.dtsi"
#include "tegra234-p3737-0000.dtsi"

/ {
	// model = "NVIDIA Jetson AGX Orin Developer Kit";
	model = "Astute GXA-1";
	compatible = "nvidia,p3737-0000+p3701-0000", "nvidia,p3701-0000", "nvidia,tegra234";

	aliases {
		serial0 = &tcu;
		serial2 = &{/bus@0/serial@3140000};
		serial4 = &{/bus@0/serial@3130000};
		serial3 = &{/bus@0/serial@3110000};
		serial1 = &{/bus@0/serial@3100000};
	};

	chosen {
		bootargs = "console=ttyTCU0,115200n8";
		stdout-path = "serial0:115200n8";
	};

	bus@0 {
		serial@3100000 {
			current-speed = <115200>;
			status = "okay";
		};
		serial@3110000 {
			current-speed = <115200>;
			status = "okay";
		};
		serial@3130000 {
			current-speed = <115200>;
			status = "okay";
		};
		serial@3140000 {
			current-speed = <115200>;
			status = "okay";
		};
		serial@31d0000 {
			current-speed = <115200>;
			status = "okay";
		};
		
		pwm@32a0000 {
			assigned-clocks = <&bpmp TEGRA234_CLK_PWM3>;
			assigned-clock-parents = <&bpmp TEGRA234_CLK_PLLP_OUT0>;
			status = "okay";
		};

		hda@3510000 {
			nvidia,model = "NVIDIA Jetson AGX Orin HDA";
			status = "okay";
		};

		padctl@3520000 {
			status = "okay";

			pads {
				usb2 {
					lanes {
						usb2-0 {
							nvidia,function = "xusb";
							status = "okay"; // usb debug
						};

						usb2-1 {
							nvidia,function = "xusb";
							status = "okay"; // goes to usb hub
						};

						usb2-2 {
							nvidia,function = "xusb";
							status = "okay"; // standalone usb hub
						};

						usb2-3 {
							nvidia,function = "xusb";
							status = "disabled"; // not using so disabling
						};
					};
				};

				usb3 {
					lanes {
						usb3-0 {
							nvidia,function = "xusb";
							status = "disabled"; // not using so disabling
						};

						usb3-1 {
							nvidia,function = "xusb";
							status = "okay"; // goes to usb hub
						};

						usb3-2 {
							nvidia,function = "xusb";
							status = "disabled"; // not using so disabling
						};
					};
				};
			};

			ports {
				usb2-0 {
					mode = "otg";
					// mode = "device";
					usb-role-switch;
					vbus-supply = <&vdd_5v0_sys>;
					status = "okay"; // usb debug
				};

				usb2-1 {
					mode = "host";
					status = "okay"; // goes to usb hub
					vbus-supply = <&vdd_5v0_sys>;
				};

				usb2-2 {
					mode = "host";
					vbus-supply = <&vbus_usb2_2>;
					status = "okay"; // standalone usb port
				};

				usb2-3 {
					mode = "host";
					vbus-supply = <&vdd_5v0_sys>;
					status = "disabled"; // not using so disabling
				};

				usb3-0 {
					nvidia,usb2-companion = <3>; // changed from 1 (not using)
					status = "disabled"; // not using so disabling
				};

				usb3-1 {
					nvidia,usb2-companion = <1>; // changed from 0
					status = "okay"; // goes to usb hub
				};

				usb3-2 {
					nvidia,usb2-companion = <2>; // changed from 3
					status = "disabled"; // not using to disabling
				};
			};
		};

		usb@3550000 {
			status = "okay";

			phys = <&{/bus@0/padctl@3520000/pads/usb2/lanes/usb2-1}>,
			       <&{/bus@0/padctl@3520000/pads/usb3/lanes/usb3-1}>;
			phy-names = "usb2-1", "usb3-1"; // changing usb2-0 to usb2-1
		};

		usb@3610000 {
			status = "okay";

			phys = <&{/bus@0/padctl@3520000/pads/usb2/lanes/usb2-0}>,
			       <&{/bus@0/padctl@3520000/pads/usb2/lanes/usb2-1}>,
			       <&{/bus@0/padctl@3520000/pads/usb2/lanes/usb2-2}>,
			       <&{/bus@0/padctl@3520000/pads/usb2/lanes/usb2-3}>,
			       <&{/bus@0/padctl@3520000/pads/usb3/lanes/usb3-0}>,
			       <&{/bus@0/padctl@3520000/pads/usb3/lanes/usb3-1}>,
			       <&{/bus@0/padctl@3520000/pads/usb3/lanes/usb3-2}>;
			phy-names = "usb2-0", "usb2-1", "usb2-2", "usb2-3",
				    "usb3-0", "usb3-1", "usb3-2";
		};

		ethernet@6800000 {
			status = "okay";
			phy-handle = <&mgbe0_phy>;
			phy-mode = "10gbase-r";
			nvidia,phy-reset-gpio = <&gpio TEGRA234_MAIN_GPIO(Y, 1) 0>; // added

			mdio {
				#address-cells = <1>;
				#size-cells = <0>;

				mgbe0_phy: phy@0 {
					compatible = "ethernet-phy-ieee802.3-c45";
					reg = <0x0>;

					#phy-cells = <0>;
				};
			};
		};
		
		pcie@14100000 {
			status = "okay";

			vddio-pex-ctl-supply = <&vdd_1v8_ao>;

			phys = <&p2u_hsio_3>;
			phy-names = "p2u-0";
		};

		pcie@14160000 {
			status = "okay";

			vddio-pex-ctl-supply = <&vdd_1v8_ao>;

			phys = <&p2u_hsio_4>, <&p2u_hsio_5>, <&p2u_hsio_6>,
			       <&p2u_hsio_7>;
			phy-names = "p2u-0", "p2u-1", "p2u-2", "p2u-3";
		};

		pcie@141a0000 {
			status = "okay";

			vddio-pex-ctl-supply = <&vdd_1v8_ls>;
			vpcie3v3-supply = <&vdd_3v3_pcie>;
			vpcie12v-supply = <&vdd_12v_pcie>;

			phys = <&p2u_nvhs_0>, <&p2u_nvhs_1>, <&p2u_nvhs_2>,
			       <&p2u_nvhs_3>, <&p2u_nvhs_4>, <&p2u_nvhs_5>,
			       <&p2u_nvhs_6>, <&p2u_nvhs_7>;
			phy-names = "p2u-0", "p2u-1", "p2u-2", "p2u-3", "p2u-4",
				    "p2u-5", "p2u-6", "p2u-7";
		};

		pcie-ep@141a0000 {
			status = "disabled";

			vddio-pex-ctl-supply = <&vdd_1v8_ls>;

			reset-gpios = <&gpio TEGRA234_MAIN_GPIO(AF, 1) GPIO_ACTIVE_LOW>;

			nvidia,refclk-select-gpios = <&gpio_aon
						      TEGRA234_AON_GPIO(AA, 4)
						      GPIO_ACTIVE_HIGH>;

			phys = <&p2u_nvhs_0>, <&p2u_nvhs_1>, <&p2u_nvhs_2>,
			       <&p2u_nvhs_3>, <&p2u_nvhs_4>, <&p2u_nvhs_5>,
			       <&p2u_nvhs_6>, <&p2u_nvhs_7>;
			phy-names = "p2u-0", "p2u-1", "p2u-2", "p2u-3", "p2u-4",
				    "p2u-5", "p2u-6", "p2u-7";
		};
	};

	gpio-keys {
		compatible = "gpio-keys";
		status = "okay";

		key-force-recovery {
			label = "Force Recovery";
			gpios = <&gpio TEGRA234_MAIN_GPIO(G, 0) GPIO_ACTIVE_LOW>;
			linux,input-type = <EV_KEY>;
			linux,code = <BTN_1>;
		};

		key-power {
			label = "Power";
			gpios = <&gpio_aon TEGRA234_AON_GPIO(EE, 4) GPIO_ACTIVE_LOW>;
			linux,input-type = <EV_KEY>;
			linux,code = <KEY_POWER>;
			wakeup-event-action = <EV_ACT_ASSERTED>;
			wakeup-source;
		};

		key-suspend {
			label = "Suspend";
			gpios = <&gpio TEGRA234_MAIN_GPIO(G, 2) GPIO_ACTIVE_LOW>;
			linux,input-type = <EV_KEY>;
			linux,code = <KEY_SLEEP>;
		};
	};

	serial {
		status = "okay";
	};
	
	thermal-zones {
		tj-thermal {
			cooling-maps {
				map-active-0 {
					trip = <&tj_trip_active0>;
				};

				map-active-1 {
					trip = <&tj_trip_active1>;
				};
			};
		};
	};
};
